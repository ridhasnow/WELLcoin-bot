<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Missions</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body {
      background: black;
      color: white;
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
      margin: 0;
    }

    .header-box {
      background: #1a1a1a;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      margin-bottom: 30px;
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
    }

    .header-box h1 {
      font-size: 26px;
      color: white;
      background: linear-gradient(90deg, gold, white);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 6px rgba(255, 215, 0, 0.4);
      margin: 0;
    }

    #back-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      padding: 8px 14px;
      background: #222;
      border-radius: 8px;
      color: gold;
      border: 2px solid gold;
      font-weight: bold;
      cursor: pointer;
    }

    #missions {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .mission {
      display: flex;
      align-items: center;
      background: #2a2a2a;
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.1);
      position: relative;
      overflow: hidden;
    }

    .mission img {
      width: 60px;
      height: 60px;
      margin-right: 16px;
      flex-shrink: 0;
    }

    .mission-content {
      flex: 1;
      color: white;
    }

    .mission-content h3 {
      margin: 0 0 6px;
      font-size: 18px;
    }

    .mission-content p {
      margin: 0;
      font-size: 14px;
      color: #ddd;
    }
    .progress-container {
  width: 100%;
  background: #444;
  border-radius: 10px;
  height: 12px;
  margin-top: 8px;
  overflow: hidden;
}
    .progress-bar {
      height: 10px;
      border-radius: 10px;
      margin-top: 10px;
      background: linear-gradient(90deg, red, orange, green);
    }

    button {
      padding: 10px 18px;
      background: #0f0;
      color: black;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-left: auto;
    }

    button:disabled {
      background: gray;
      cursor: not-allowed;
    }

    .popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 0 25px rgba(255, 255, 255, 0.2);
      z-index: 999;
      text-align: center;
      display: none;
    }

    .popup p {
      color: black;
      margin-bottom: 15px;
    }

    .popup button {
      background: dodgerblue;
      color: white;
      padding: 10px 18px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
    }

    .led-glow {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      box-shadow: inset 0 0 0 2px rgba(255, 215, 0, 0.5);
      animation: rotateGlow 3s linear infinite;
    }

    @keyframes rotateGlow {
      0% { box-shadow: inset 2px 0 6px gold; }
      25% { box-shadow: inset 0 2px 6px gold; }
      50% { box-shadow: inset -2px 0 6px gold; }
      75% { box-shadow: inset 0 -2px 6px gold; }
      100% { box-shadow: inset 2px 0 6px gold; }
    }
  </style>
</head>
<body>
  <div id="back-btn" onclick="history.back()">‚Üê Back</div>
  <div class="header-box">
    <h1>You Can Do It</h1>
  </div>

  <div id="missions"></div>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyB9uNwUURvf5RsD7CnsG2LtE6fz5yboBkw",
      authDomain: "wellcoinbotgame.firebaseapp.com",
      databaseURL: "https://wellcoinbotgame-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "wellcoinbotgame",
      storageBucket: "wellcoinbotgame.appspot.com",
      messagingSenderId: "108640533638",
      appId: "1:108640533638:web:ed07516d96ac38f47f6507"
    };
    
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database(app);
    const tg = window.Telegram.WebApp;
    tg.ready();

    const userId = tg.initDataUnsafe?.user?.id;
    const missionsDiv = document.getElementById("missions");

    async function getUserData() {
      const snap = await db.ref("users/" + userId).once("value");
      return snap.val() || {};
    }

    async function updateUserData(data) {
      await db.ref("users/" + userId).update(data);
    }

    function renderMission({ id, title, desc, icon, reward, progress = null, claimed = false, buttonText = "", onClick }) {
      const div = document.createElement("div");
      div.className = "mission";

      div.innerHTML = `
        <div class="led-glow"></div>
        <img src="${icon}" alt="${title}" />
        <div class="mission-content">
          <h3>${title}</h3>
          <p>${desc}</p>
          ${progress !== null ? `
            <div class="progress-container">
            <div class="progress-bar" style="width:${progress}%"></div>
            </div>
        <p style="margin-top:4px; font-size:12px;">${refCount}/${target}</p>
        <button id="btn-${id}" ${claimed ? "disabled" : ""}>
          ${claimed ? "Claimed" : buttonText}
        </button>
      `;
      missionsDiv.appendChild(div);
      document.getElementById(`btn-${id}`).onclick = onClick;
    }

    async function renderMissions() {
      if (!userId) return alert("User ID missing");

      const user = await getUserData();
      const userMissions = user.missions || {};
      const claimed = (id) => userMissions[id]?.claimed || false;

      const socials = [
        { id: "youtube", title: "Follow us on YouTube", icon: "youtube-icon.png", url: "https://youtube.com", reward: 1, type: "follow" },
        { id: "telegram", title: "Join our Telegram", icon: "telegram-icon.png", url: "https://t.me/WELLcoinofficial", reward: 1, type: "join" },
        { id: "instagram", title: "Follow us on Instagram", icon: "instagram-icon.png", url: "https://instagram.com", reward: 1, type: "follow" },
        { id: "facebook", title: "Like our Facebook page", icon: "facebook-icon.png", url: "https://facebook.com", reward: 1, type: "follow" },
        { id: "tiktok", title: "Follow us on TikTok", icon: "tiktok-icon.png", url: "https://tiktok.com", reward: 1, type: "follow" },
        { id: "x", title: "Follow us on X (Twitter)", icon: "twitter-icon.png", url: "https://x.com", reward: 1, type: "follow" }
      ];
      for (const { id, title, icon, url, reward, type } of socials) {
        renderMission({
          id,
          title,
          desc: `Reward: ${reward} WLC`,
          icon,
          reward,
          claimed: claimed(id),
          buttonText: claimed(id) ? "Visit" : (type === "join" ? "Join Now" : "Follow"),
          onClick: async () => {
            if (claimed(id)) {
              window.open(url, "_blank");
              return;
            }

            window.open(url, "_blank");

            setTimeout(() => {
              const popup = document.createElement("div");
              popup.className = "popup";
              popup.innerHTML = `
                <p>You finish?</p>
                <p style="font-size:13px; color:#444;">If you unsubscribe, the reward will be deducted later. No need for tricks, we‚Äôre a team ‚ô•</p>
                <button id="yes-${id}">Yes I Do</button>
              `;
              document.body.appendChild(popup);
              popup.style.display = "block";

              document.getElementById(`yes-${id}`).onclick = async () => {
                const newBalance = (parseFloat(user.balance || 0) + reward).toFixed(10);
                await updateUserData({
                  balance: newBalance,
                  missions: { ...userMissions, [id]: { claimed: true } }
                });
                popup.remove();
                alert(`‚úÖ You earned ${reward} WLC!`);
                location.reload();
              };
            }, 1000);
          }
        });
      }

      // Daily Reward
      const dailyId = "daily";
      const lastClaim = userMissions[dailyId]?.lastClaim || 0;
      const now = Date.now();
      const elapsed = now - lastClaim;
      const dailyAvailable = elapsed > 86400000;
      const remaining = 86400000 - elapsed;
      const iconDaily = "daily-icon.png";

      renderMission({
        id: dailyId,
        title: "Daily Reward",
        desc: dailyAvailable
          ? "Claim your 1 WLC!"
          : `Come back in ${new Date(remaining).toISOString().substr(11, 8)} to claim again.`,
        icon: iconDaily,
        reward: 1,
        claimed: !dailyAvailable,
        buttonText: "Claim",
        onClick: async () => {
          const newBalance = (parseFloat(user.balance || 0) + 1).toFixed(10);
          await updateUserData({
            balance: newBalance,
            missions: { ...userMissions, [dailyId]: { lastClaim: now } }
          });
          alert("‚úÖ Daily reward claimed!");
          location.reload();
        }
      });
      // Invite Friends Missions
      const invites = [
        { id: "invite5", icon: "invit1.png", label: "Invite 5 Friends", target: 5, reward: 0.5 },
        { id: "invite20", icon: "invit2.png", label: "Invite 20 Friends", target: 20, reward: 2 },
        { id: "invite100", icon: "invit3.png", label: "Invite 100 Friends", target: 100, reward: 10 }
      ];
      const refCount = user.referrals || 0;

      for (const { id, label, icon, target, reward } of invites) {
        const done = refCount >= target;
        const alreadyClaimed = claimed(id);

        renderMission({
          id,
          title: label,
          desc: `Progress: ${refCount}/${target} ‚Äì Reward: $${reward}`,
          icon,
          reward,
          progress: Math.min((refCount / target) * 100, 100),
          claimed: alreadyClaimed,
          buttonText: alreadyClaimed ? "Claimed" : (done ? "Claim" : "Start Invite"),
          onClick: async () => {
            if (alreadyClaimed) return;

            if (!done) {
              const popup = document.createElement("div");
              popup.className = "popup";
              const inviteLink = `https://t.me/WELLcoinofficial_bot?start=${userId}`;
              popup.innerHTML = `
                <p>Your Invite Link:</p>
                <p style="word-break: break-word; color: black;">${inviteLink}</p>
                <button id="copy-${id}">Copy</button>
              `;
              document.body.appendChild(popup);
              popup.style.display = "block";

              document.getElementById(`copy-${id}`).onclick = () => {
                navigator.clipboard.writeText(inviteLink).then(() => {
                  alert("‚úÖ Copied! Invite your friends now.");
                  popup.remove();
                });
              };
            } else {
              const newBalance = (parseFloat(user.balance || 0) + reward).toFixed(10);
              await updateUserData({
                balance: newBalance,
                missions: { ...userMissions, [id]: { claimed: true } }
              });

              const popup = document.createElement("div");
              popup.className = "popup";
              popup.innerHTML = `
                <p>üéâ +$${reward} USDT</p>
                <p style="font-size:13px; color:#444;">No cheating, rewards are tracked.</p>
                <button id="done-${id}">Thank You</button>
              `;
              document.body.appendChild(popup);
              popup.style.display = "block";

              document.getElementById(`done-${id}`).onclick = () => {
                popup.remove();
                location.reload();
              };
            }
          }
        });
      }
    }

    window.onload = renderMissions;
  </script>
</body>
</html>
