<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Missions</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body {
      background: black;
      color: gold;
      font-family: sans-serif;
      padding: 20px;
    }
    .mission {
      border: 2px solid gold;
      padding: 16px;
      border-radius: 12px;
      margin: 16px 0;
      background: #111;
    }
    button {
      padding: 10px 20px;
      background: gold;
      color: black;
      font-weight: bold;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    button:disabled {
      background: gray;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <h1>ðŸŽ¯ Missions</h1>
  <div id="missions"></div>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyB9uNwUURvf5RsD7CnsG2LtE6fz5yboBkw",
      authDomain: "wellcoinbotgame.firebaseapp.com",
      databaseURL: "https://wellcoinbotgame-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "wellcoinbotgame",
      storageBucket: "wellcoinbotgame.appspot.com",
      messagingSenderId: "108640533638",
      appId: "1:108640533638:web:ed07516d96ac38f47f6507"
    };const app = firebase.initializeApp(firebaseConfig);
const db = firebase.database(app);
const tg = window.Telegram.WebApp;
tg.ready();

const userId = tg.initDataUnsafe?.user?.id;
const missionsDiv = document.getElementById("missions");

async function getUserData() {
  const snap = await db.ref("users/" + userId).once("value");
  return snap.val() || {};
}

async function updateUserData(data) {
  await db.ref("users/" + userId).update(data);
}

function renderMission(title, desc, id, reward, isClaimed, onClick) {
  const div = document.createElement("div");
  div.className = "mission";
  div.innerHTML = `
    <h3>${title}</h3>
    <p>${desc}</p>
    <button id="btn-${id}" ${isClaimed ? "disabled" : ""}>
      ${isClaimed ? "Claimed" : `Claim ${reward} WLC`}
    </button>
  `;
  missionsDiv.appendChild(div);
  document.getElementById("btn-" + id).onclick = onClick;
}

async function renderMissions() {
  if (!userId) return alert("User ID missing");

  const user = await getUserData();
  const userMissions = user.missions || {};
  const claimed = (id) => userMissions[id]?.claimed || false;

  const reward = 0.5;
  const socials = [
    { id: "youtube", title: "Join us on YouTube", url: "https://youtube.com", reward },
    { id: "telegram", title: "Join us on Telegram", url: "https://t.me/WELLcoinofficial", reward },
    { id: "instagram", title: "Follow us on Instagram", url: "https://instagram.com", reward },
    { id: "facebook", title: "Like our Facebook page", url: "https://facebook.com", reward },
    { id: "tiktok", title: "Follow us on TikTok", url: "https://tiktok.com", reward },
    { id: "x", title: "Follow us on X (Twitter)", url: "https://x.com", reward }
  ];

  socials.forEach(({ id, title, url, reward }) => {
    renderMission(title, `Click to visit and claim ${reward} WLC.`, id, reward, claimed(id), async () => {
      window.open(url, "_blank");
      const confirm = window.confirm("Did you follow/subscribe?");
      if (!confirm) return;
      const newBalance = (parseFloat(user.balance || 0) + reward).toFixed(10);
      await updateUserData({
        balance: newBalance,
        missions: { ...userMissions, [id]: { claimed: true } }
      });
      alert("âœ… Reward claimed!");
      location.reload();
    });
  });

  // Daily Reward
  const dailyId = "daily";
  const lastClaim = userMissions[dailyId]?.lastClaim || 0;
  const now = Date.now();
  const elapsed = now - lastClaim;
  const canClaim = elapsed > 86400000;

  renderMission("Daily Reward", "Come back every 24h for a free 1 WLC!", dailyId, 1, !canClaim, async () => {
    const newBalance = (parseFloat(user.balance || 0) + 1).toFixed(10);
    await updateUserData({
      balance: newBalance,
      missions: { ...userMissions, [dailyId]: { lastClaim: now } }
    });
    alert("âœ… Daily reward claimed!");
    location.reload();
  });

  // Invite Friends
  const invites = [
    { id: "invite5", label: "Invite 5 Friends", target: 5, reward: 0.5 },
    { id: "invite20", label: "Invite 20 Friends", target: 20, reward: 2 },
    { id: "invite100", label: "Invite 100 Friends", target: 100, reward: 10 }
  ];
  const refCount = user.referrals || 0;
  invites.forEach(({ id, label, target, reward }) => {
    const done = refCount >= target;
    renderMission(label, `Current: ${refCount}/${target} - Reward: ${reward} USDT`, id, reward, claimed(id), async () => {
      if (!done) return alert("You haven't invited enough friends yet.");
      const newBalance = (parseFloat(user.balance || 0) + reward).toFixed(10);
      await updateUserData({
        balance: newBalance,
        missions: { ...userMissions, [id]: { claimed: true } }
      });
      alert("âœ… Invite mission claimed!");
      location.reload();
    });
  });
}

window.onload = renderMissions;

  </script>
</body>
</html>
