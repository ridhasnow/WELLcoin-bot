<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WELLcoin Missions</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #000;
      color: #ffd700;
      padding: 60px 16px 20px;
      position: relative;
    }
    .back-button {
      position: fixed;
      top: 10px;
      left: 10px;
      background-color: #fff;
      color: #000;
      border: none;
      border-radius: 8px;
      padding: 6px 12px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      z-index: 10;
    }
    .mission {
      background-color: #111;
      border: 1px solid #ffd700;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 0 6px rgba(255, 215, 0, 0.2);
    }
    .mission h2 {
      margin: 0 0 8px;
      font-size: 18px;
      color: #fff;
      text-shadow: 0 0 4px rgba(255,255,255,0.3);
    }
    .mission p {
      margin: 0;
      font-size: 14px;
      color: #e6d8a3;
    }
    .mission button {
      margin-top: 10px;
      padding: 6px 12px;
      border: none;
      border-radius: 8px;
      background-color: #ffd700;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      transition: 0.2s;
    }
    .mission button:hover:enabled {
      background-color: #fff;
    }
    .mission button:disabled {
      background-color: #444;
      color: #0f0;
      cursor: not-allowed;
    }
    .mission-icon {
      width: 70px;
      height: 70px;
      vertical-align: middle;
      margin-right: 8px;
      filter: drop-shadow(0 0 2px gold);
      border-radius: 6px;
    }
    .claim-popup, .invite-popup, .popup, .social-popup, .social-popup-again {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #000;
      color: #00ff88;
      padding: 16px 32px;
      font-size: 20px;
      font-weight: bold;
      border-radius: 14px;
      border: 2px solid #ffd700;
      box-shadow: 0 0 20px gold;
      z-index: 9999;
      display: none;
      text-align: center;
    }
    .popup-message {
      font-size: 13px;
      margin-top: 8px;
      line-height: 1.6;
      font-weight: 500;
      color: white;
    }
    .popup-agree-btn, .popup button, .invite-popup button {
      margin-top: 12px;
      padding: 10px 20px;
      background-color: #0099ff;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: bold;
      box-shadow: 0 0 8px #0099ff;
      cursor: pointer;
    }
    .popup-small {
      font-size: 14px;
      color: #0f0;
    }
    .timer-text {
      margin-top: 8px;
      font-size: 13px;
      color: #aaa;
    }
    .invite-link {
      background-color: #111;
      color: white;
      padding: 10px;
      font-size: 13px;
      border-radius: 8px;
      overflow-wrap: anywhere;
      word-break: break-word;
      box-shadow: 0 0 10px white;
    }
  </style>
</head>
<body>
  <button class="back-button" onclick="window.location.href='index.html'">‚Üê</button>
  <h1 style="text-align:center;">Available Missions</h1>
  <div class="mission" id="daily-reward-container">
    <h2><img src="daily-icon.png" class="mission-icon" />Daily Rewards</h2>
    <p>Come back every 24h and earn 0.00001 WLC</p>
    <button id="claim-btn" onclick="claimDaily()">Claim</button>
    <div id="timer" class="timer-text"></div>
  </div>
  <!-- YouTube Mission -->
<div class="mission" id="youtube-container">
  <h2><img src="youtube-icon.png" class="mission-icon" />Join us on YouTube</h2>
  <p>Subscribe to our YouTube channel and earn 1 WLC</p>
  <button id="youtube-btn" onclick="handleSocial('youtube', 'https://youtube.com/@WELLcoinofficial')">Join Now</button>
</div>

<!-- Telegram Mission -->
<div class="mission" id="telegram-container">
  <h2><img src="telegram-icon.png" class="mission-icon" />Join us on Telegram</h2>
  <p>Join our Telegram channel and earn 1 WLC</p>
  <button id="telegram-btn" onclick="handleSocial('telegram', 'https://t.me/WELLcoinofficial')">Join Now</button>
</div>

<!-- Instagram Mission -->
<div class="mission" id="instagram-container">
  <h2><img src="instagram-icon.png" class="mission-icon" />Follow us on Instagram</h2>
  <p>Follow our Instagram page and earn 1 WLC</p>
  <button id="instagram-btn" onclick="handleSocial('instagram', 'https://instagram.com/WELLcoin')">Follow</button>
</div>

<!-- Facebook Mission -->
<div class="mission" id="facebook-container">
  <h2><img src="facebook-icon.png" class="mission-icon" />Like us on Facebook</h2>
  <p>Like our Facebook page and earn 1 WLC</p>
  <button id="facebook-btn" onclick="handleSocial('facebook', 'https://facebook.com/WELLcoin')">Like</button>
</div>

<!-- TikTok Mission -->
<div class="mission" id="tiktok-container">
  <h2><img src="tiktok-icon.png" class="mission-icon" />Follow us on TikTok</h2>
  <p>Follow our TikTok and earn 1 WLC</p>
  <button id="tiktok-btn" onclick="handleSocial('tiktok', 'https://tiktok.com/@WELLcoin')">Follow</button>
</div>

<!-- X (Twitter) Mission -->
<div class="mission" id="x-container">
  <h2><img src="twitter-icon.png" class="mission-icon" />Follow us on X (Twitter)</h2>
  <p>Follow our X profile and earn 1 WLC</p>
  <button id="x-btn" onclick="handleSocial('x', 'https://x.com/WELLcoin')">Follow</button>
</div>
  <div id="missions-container"></div>

  <!-- Invite Friends Missions -->
<div class="mission" id="invite5-container"></div>
<div class="mission" id="invite20-container"></div>
<div class="mission" id="invite100-container"></div>
  
  <!-- Popups -->
  <div id="invite-popup" class="invite-popup">
    <div class="invite-link" id="invite-link-text"></div>
    <button onclick="copyInviteLink()">Copy</button><br/>
    <button onclick="closeInvitePopup()">Close</button>
  </div>
  <div id="reward-popup" class="popup">
    <h3 id="reward-title"></h3>
    <p>‚ö†Ô∏è Any fake referrals or cheating will freeze your account balance.</p>
    <button onclick="closeRewardPopup()">I understand</button>
  </div>
  <div id="social-popup" class="social-popup">
    <div id="popup-title">+1 WLC</div>
    <div class="popup-message">
      ‚ö†Ô∏è If you unsubscribe, the reward will be deducted after checking your tasks.<br>
      Don‚Äôt cheat, we‚Äôre on the same team.
    </div>
    <button class="popup-agree-btn" onclick="closeSocialPopup()">I agree</button>
  </div>
  <div id="social-popup-again" class="social-popup-again popup-small">
    ‚úÖ Thanks for visiting our page again!
  </div>
  <div id="copy-popup" class="popup" style="display:none;">
    <h3 style="color: #00ff66; text-shadow: 0 0 4px #00ff66;">‚úÖ Link Copied</h3>
    <p style="color: white; font-size: 14px; margin-top: 8px;">
      ‚ö†Ô∏è Fake or spammy referrals will lead to account suspension.
    </p>
    <button onclick="closeCopyPopup()" style="margin-top: 12px; padding: 10px 18px; background: #007bff; color: white; font-weight: bold; border: none; border-radius: 8px; box-shadow: 0 4px 10px rgba(0, 123, 255, 0.5);">
      I understand
    </button>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    const userId = tg.initDataUnsafe?.user?.id;
console.log("‚úÖ Telegram User ID:", userId);
    
    const app = firebase.initializeApp({
      apiKey: "AIzaSyB9uNwUURvf5RsD7CnsG2LtE6fz5yboBkw",
      authDomain: "wellcoinbotgame.firebaseapp.com",
      databaseURL: "https://wellcoinbotgame-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "wellcoinbotgame",
      storageBucket: "wellcoinbotgame.appspot.com",
      messagingSenderId: "108640533638",
      appId: "1:108640533638:web:ed07516d96ac38f47f6507"
    });
    const db = firebase.database(app);
    async function getUserData() {
      const snap = await db.ref(`users/${userId}`).get();
      return snap.exists() ? snap.val() : null;
    }

    async function updateUserData(data) {
      await db.ref(`users/${userId}`).update(data);
    }

    async function claimDaily() {
      const now = Date.now();
      const user = await getUserData();
      const lastClaim = user?.missions?.dailyLastClaim || 0;

      if (now - lastClaim >= 24 * 60 * 60 * 1000) {
        const newBalance = (parseFloat(user.balance || 0) + 0.00001).toFixed(10);
        await updateUserData({
          balance: newBalance,
          missions: {
            ...user.missions,
            dailyLastClaim: now
          }
        });
        document.getElementById("claim-btn").disabled = true;
        document.getElementById("claim-btn").textContent = "Claimed ‚úÖ";
        document.getElementById("timer").textContent = "‚úÖ Come back in 24h";
      }
    }

    function updateDailyTimer(lastClaim) {
      const timer = document.getElementById("timer");
      const btn = document.getElementById("claim-btn");
      const interval = setInterval(() => {
        const now = Date.now();
        const remaining = (24 * 60 * 60 * 1000) - (now - lastClaim);
        if (remaining > 0) {
          btn.disabled = true;
          btn.textContent = "Claimed ‚úÖ";
          const h = Math.floor(remaining / 3600000).toString().padStart(2, '0');
          const m = Math.floor((remaining % 3600000) / 60000).toString().padStart(2, '0');
          const s = Math.floor((remaining % 60000) / 1000).toString().padStart(2, '0');
          timer.textContent = `Next claim in ${h}:${m}:${s}`;
        } else {
          btn.disabled = false;
          btn.textContent = "Claim";
          timer.textContent = "";
          clearInterval(interval);
        }
      }, 1000);
    }

    async function initDailyMission() {
      const user = await getUserData();
      const lastClaim = user?.missions?.dailyLastClaim || 0;
      const now = Date.now();
      if (now - lastClaim < 24 * 60 * 60 * 1000) {
        updateDailyTimer(lastClaim);
        document.getElementById("claim-btn").disabled = true;
        document.getElementById("claim-btn").textContent = "Claimed ‚úÖ";
      } else {
        document.getElementById("claim-btn").disabled = false;
        document.getElementById("claim-btn").textContent = "Claim";
      }
    }

    initDailyMission();
  
    
      async function handleSocial(id, link) {
  const user = await getUserData();
  const done = user?.missions?.[id] || false;
  const btn = document.getElementById(`${id}-btn`);
  window.open(link, "_blank");

  setTimeout(() => {
    if (!done) {
      document.getElementById("social-popup").style.display = "block";
      document.getElementById("social-popup").setAttribute("data-id", id);
    } else {
      document.getElementById("social-popup-again").style.display = "block";
      btn.textContent = "Claimed";
      btn.disabled = true;
      setTimeout(() => {
        document.getElementById("social-popup-again").style.display = "none";
      }, 3000);
    }
  }, 1000);
}

    async function closeSocialPopup() {
  const id = document.getElementById("social-popup").getAttribute("data-id");
  const btn = document.getElementById(`${id}-btn`);
  const user = await getUserData();

  if (!user?.missions?.[id]) {
    const newBalance = (parseFloat(user.balance || 0) + 1).toFixed(10);
    await updateUserData({
      balance: newBalance,
      missions: {
        ...user.missions,
        [id]: true
      }
    });

    // ‚úÖ ŸáŸÜÿß ŸÜÿ∂ŸäŸÅ ÿßŸÑÿ≥ÿ∑ÿ± ÿßŸÑŸÖŸáŸÖ
    if (btn) {
      btn.textContent = "Claimed";
      btn.disabled = true; // ‚Üê Ÿáÿ∞ÿß ÿßŸÑÿ≥ÿ∑ÿ± ÿ∂ÿ±Ÿàÿ±Ÿä!
    }
  }

  document.getElementById("social-popup").style.display = "none";
}
// ÿ±ÿßÿ®ÿ∑ ÿØÿπŸàÿ© ÿ™ŸäŸÑŸäÿ¨ÿ±ÿßŸÖ ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ userId
const inviteLink = `https://t.me/WELLcoinBot?start=${userId}`;
const inviteMissions = [
  { id: "invite5", label: "Invite 5 friends", target: 5, reward: 0.5, img: "invit1.png" },
  { id: "invite20", label: "Invite 20 friends", target: 20, reward: 2, img: "invit2.png" },
  { id: "invite100", label: "Invite 100 friends", target: 100, reward: 10, img: "invit3.png" },
];

// ÿπÿ±ÿ∂ ŸÖŸáÿßŸÖ ÿßŸÑÿØÿπŸàÿßÿ™
async function renderInviteMissions() {
  const user = await getUserData();
  inviteMissions.forEach(({ id, label, target, reward, img }) => {
    const invited = user.missions?.[`${id}-invited`] || 0;
    const claimed = user.missions?.[`${id}-claimed`] || false;
    const canClaim = invited >= target;

    const html = `
      <h2><img src="${img}" class="mission-icon" />${label}</h2>
      <p>Invite ${target} friends and earn ${reward}$</p>
      <progress value="${invited}" max="${target}" style="width:100%;height:14px;margin-top:10px;"></progress>
      <div style="margin-top:6px;">${invited}/${target}</div>
      <button onclick="goInvite()" style="margin-right:8px;">Go Invite</button>
      <button onclick="copyInviteLink()">Copy</button>
      <button id="${id}-claim" onclick="claimInviteMission('${id}', ${reward})" style="margin-left:8px; ${canClaim && !claimed ? '' : 'display:none;'}">${claimed ? 'Claimed ‚úÖ' : 'Claim'}</button>
    `;

    document.getElementById(`${id}-container`).innerHTML = html;
  });
}

// ŸÜÿ≥ÿÆ ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿØÿπŸàÿ©
function copyInviteLink() {
  navigator.clipboard.writeText(inviteLink).then(() => {
    document.getElementById("copy-popup").style.display = "block";
  });
}

// ŸÅÿ™ÿ≠ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ±ÿßÿ®ÿ∑
function goInvite() {
  document.getElementById("invite-link-text").textContent = inviteLink;
  document.getElementById("invite-popup").style.display = "block";
}

function closeInvitePopup() {
  document.getElementById("invite-popup").style.display = "none";
}

function closeRewardPopup() {
  document.getElementById("reward-popup").style.display = "none";
}

// ÿπŸÜÿØ ÿßŸÑÿ∂ÿ∫ÿ∑ Claim
async function claimInviteMission(id, reward) {
  const user = await getUserData();
  const invited = user.missions?.[`${id}-invited`] || 0;
  const claimed = user.missions?.[`${id}-claimed`] || false;
  const target = inviteMissions.find(m => m.id === id).target;

  if (!claimed && invited >= target) {
    const newUsdt = (parseFloat(user.usdt || 0) + reward).toFixed(2);
    await updateUserData({
      usdt: newUsdt,
      missions: {
        ...user.missions,
        [`${id}-claimed`]: true
      }
    });

    showRewardPopup(reward);
    const claimBtn = document.getElementById(`${id}-claim`);
    if (claimBtn) {
      claimBtn.disabled = true;
      claimBtn.textContent = "Claimed ‚úÖ";
    }
  }
}

// ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ™ŸáŸÜÿ¶ÿ©
function showRewardPopup(rewardText) {
  document.getElementById("reward-title").textContent = `üéâ Congratulations you earned ${rewardText}$`;
  document.getElementById("reward-popup").style.display = "block";
}


    function closeCopyPopup() {
      document.getElementById("copy-popup").style.display = "none";
    }
    initializeInviteMissions().then(renderInviteMissions);
    async function initializeInviteMissions() {
  const user = await getUserData();
  if (!user.missions || user.missions["invite5-invited"] === undefined) {
    await updateUserData({
      missions: {
        ...user.missions,
        "invite5-invited": 0,
        "invite5-claimed": false,
        "invite20-invited": 0,
        "invite20-claimed": false,
        "invite100-invited": 0,
        "invite100-claimed": false
      }
    });
  }
}
