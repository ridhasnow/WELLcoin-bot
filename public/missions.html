<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WELLcoin Missions</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body {
      background-color: #000;
      color: gold;
      font-family: 'Segoe UI', sans-serif;
      padding: 0;
      margin: 0;
    }
    header {
      background-color: #1a1a1a;
      padding: 20px;
      text-align: center;
    }
    header h1 {
      margin: 0;
      font-size: 24px;
      color: white;
      text-shadow: 0 0 8px gold;
    }
    .back-button {
      position: absolute;
      top: 18px;
      left: 20px;
      background-color: transparent;
      border: 2px solid gold;
      color: gold;
      padding: 8px 14px;
      border-radius: 10px;
      font-weight: bold;
      cursor: pointer;
    }

    #missions {
      padding: 20px;
    }

    .mission {
      background-color: #191919;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      position: relative;
      overflow: hidden;
    }

    .mission h3 {
      margin-top: 0;
      color: white;
      font-size: 18px;
      text-shadow: 0 0 6px #ffaa00;
    }

    .mission p {
      margin-bottom: 12px;
      color: #ccc;
    }

    .mission .icon {
      width: 50px;
      height: 50px;
      float: left;
      margin-right: 12px;
    }

    .progress-bar {
      width: 100%;
      height: 14px;
      background: #333;
      border-radius: 8px;
      margin: 8px 0;
      overflow: hidden;
    }

    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(to right, red, orange, yellow, green);
      width: 0%;
      transition: width 0.5s;
    }

    button {
      padding: 10px 20px;
      background: #00cc66;
      color: white;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-right: 10px;
    }

    button:disabled {
      background: gray;
      cursor: not-allowed;
    }

    .glow-border {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      border-radius: 12px;
      pointer-events: none;
      box-shadow: 0 0 20px 3px gold;
      animation: rotateGlow 3s linear infinite;
    }

    @keyframes rotateGlow {
      0% { box-shadow: 0 0 20px 3px gold; }
      25% { box-shadow: 5px 0 25px 3px gold; }
      50% { box-shadow: 0 5px 25px 3px gold; }
      75% { box-shadow: -5px 0 25px 3px gold; }
      100% { box-shadow: 0 -5px 20px 3px gold; }
    }

    .popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #222;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
      z-index: 9999;
      color: white;
      text-align: center;
      display: none;
      width: 90%;
      max-width: 400px;
    }

    .popup p {
      margin-bottom: 10px;
      font-size: 16px;
    }

    .popup button {
      margin-top: 10px;
      background: #0077ff;
    }
    .mission {
  position: relative;
  background: #1a1a1a;
  color: white;
  border-radius: 12px;
  margin: 20px 0;
  padding: 16px 16px 16px 80px;
  overflow: hidden;
  box-shadow: 0 0 10px rgba(255, 215, 0, 0.2);
}

.mission img.icon {
  position: absolute;
  top: 20px;
  left: 20px;
  width: 40px;
  height: 40px;
}

.mission-glow {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border-radius: 12px;
  box-shadow: 0 0 8px 4px rgba(255, 215, 0, 0.3);
  animation: glowMove 2s linear infinite;
  pointer-events: none;
}

@keyframes glowMove {
  0% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
  50% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.6); }
  100% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
}

.popup {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #222;
  color: white;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 0 20px gold;
  z-index: 9999;
  width: 80%;
  max-width: 300px;
  display: none;
}

.popup button {
  margin-top: 10px;
  background: gold;
  color: black;
  border: none;
  padding: 10px;
  border-radius: 8px;
  width: 100%;
}
  </style>
</head>
<body>
  <header>
    
    <button class="back-button" onclick="history.back()">← Back</button>
    <h1>You Can Do It</h1>
  </header>

  <div id="missions"></div>

  
<div class="mission" id="telegram-mission">
  <img src="telegram-icon.png" style="width:60px; float:left; margin-right:15px;">
  <h3>Join us on Telegram</h3>
  <p>Click the button and join our Telegram community.</p>
  <button class="btn" id="telegram-btn">Join Now</button>
</div>
  

               <!--البوب آب السوشيال ميديا ككل-->
  <div id="social-popup" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#000000e0; backdrop-filter: blur(3px); z-index:1000; display:flex; align-items:center; justify-content:center;">
  <div style="background:#111; padding:20px; border-radius:12px; max-width:90%; color:white; text-align:center; position:relative;">
    <div style="position:absolute; top:10px; right:15px; font-size:18px; cursor:pointer; color:white;" onclick="closeSocialPopup()">✖</div>
    <h2 id="popup-title" style="color:gold; margin-bottom:12px;">You Click Finish?</h2>
    <p style="font-size:14px; margin-bottom:15px;">⚠️ If you unsubscribe, the reward will be deducted. Don’t cheat, we’re on the same team.</p>
    <button id="popup-confirm-btn" style="background:#00ff88; color:black; border:none; border-radius:6px; padding:10px 20px; font-weight:bold;">Yes I Do</button>
  </div>
</div>
</body>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyB9uNwUURvf5RsD7CnsG2LtE6fz5yboBkw",
    authDomain: "wellcoinbotgame.firebaseapp.com",
    databaseURL: "https://wellcoinbotgame-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "wellcoinbotgame",
    storageBucket: "wellcoinbotgame.appspot.com",
    messagingSenderId: "108640533638",
    appId: "1:108640533638:web:ed07516d96ac38f47f6507"
  };

  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.database(app);
  const tg = window.Telegram.WebApp;
  tg.ready();
  const userId = tg.initDataUnsafe?.user?.id;


  const invites = [
    { id: "invite5", label: "Invite 5 Friends", target: 5, reward: 0.5 },
    { id: "invite20", label: "Invite 20 Friends", target: 20, reward: 2 },
    { id: "invite100", label: "Invite 100 Friends", target: 100, reward: 10 }
  ];

  async function getUserData() {
    const snap = await db.ref("users/" + userId).once("value");
    return snap.val() || {};
  }

  async function updateUserData(data) {
    await db.ref("users/" + userId).update(data);
  }

  function renderProgress(current, target) {
    const percent = Math.min((current / target) * 100, 100);
    return `<div style='background:#333; border-radius:6px; height:10px; overflow:hidden; margin:6px 0;'>
      <div style='width:${percent}%; height:100%; background:linear-gradient(to right, red, orange, green);'></div>
    </div>`;
  }

  
    invites.forEach(({ id, label, target, reward }) => {
      const invited = user.referrals || 0;
      const isClaimed = claimed(id);
      const completed = invited >= target;
      const div = document.createElement("div");
      div.className = "mission";
      div.innerHTML = `
        <h3>${label}</h3>
        ${renderProgress(invited, target)}
        <p>${invited}/${target} - Reward: ${reward} USDT</p>
        <button onclick="handleInvite('${id}', ${reward}, ${completed})" ${isClaimed ? "disabled" : ""}>
          ${isClaimed ? "Claimed" : completed ? "Claim" : "Start Invite"}
        </button>`;
      missions.appendChild(div);
    });

    // Daily reward
    const now = Date.now();
    const daily = user.missions?.daily || {};
    const lastClaim = daily.lastClaim || 0;
    const canClaim = now - lastClaim > 86400000;
    const div = document.createElement("div");
    div.className = "mission";
    div.innerHTML = `
      <h3>Daily Reward</h3>
      <p>Reward: 1 WLC</p>
      <button onclick="claimDaily()" ${canClaim ? "" : "disabled"}>
        ${canClaim ? "Claim" : "Claimed"}
      </button>`;
    missions.appendChild(div);
  }

  
renderMission("Join us on YouTube", "Subscribe and earn 1 WLC", "youtube", 1, claimed("youtube"), () => {
  handleSocial("youtube", "https://youtube.com/...", 1);
});

renderMission("Join us on Telegram", "Join the channel and earn 1 WLC", "telegram", 1, claimed("telegram"), () => {
  handleSocial("telegram", "https://t.me/WELLcoinofficial", 1);
});

renderMission("Follow us on Instagram", "Follow and earn 1 WLC", "instagram", 1, claimed("instagram"), () => {
  handleSocial("instagram", "https://instagram.com/...", 1);
});

renderMission("Like us on Facebook", "Like our page and earn 1 WLC", "facebook", 1, claimed("facebook"), () => {
  handleSocial("facebook", "https://facebook.com/...", 1);
});

renderMission("Follow us on TikTok", "Follow and earn 1 WLC", "tiktok", 1, claimed("tiktok"), () => {
  handleSocial("tiktok", "https://tiktok.com/...", 1);
});

renderMission("Follow us on X (Twitter)", "Follow and earn 1 WLC", "x", 1, claimed("x"), () => {
  handleSocial("x", "https://x.com/...", 1);
});
  
  async function handleSocial(id, url, reward) {
  window.open(url, "_blank");
  showSocialPopup(async () => {
    const user = await getUserData();
    if (user.missions?.[id]?.claimed) return alert("Already claimed");

    const newBalance = (parseFloat(user.balance || 0) + reward).toFixed(10);
    await updateUserData({
      balance: newBalance,
      missions: { ...(user.missions || {}), [id]: { claimed: true } }
    });
    document.getElementById("success-msg").innerText = `+${reward} WLC`;
    document.getElementById("popup-success").style.display = "block";
  });
}

function showSocialPopup(callback) {
  document.getElementById("social-popup").style.display = "flex";
  document.getElementById("popup-confirm-btn").onclick = async () => {
    await callback();
    closeSocialPopup();
  };
}

function closeSocialPopup() {
  document.getElementById("social-popup").style.display = "none";
}

  async function confirmSocial() {
    const popup = document.getElementById("popup-social");
    const id = popup.dataset.id;
    const reward = parseFloat(popup.dataset.reward);
    const user = await getUserData();
    const newBalance = (parseFloat(user.balance || 0) + reward).toFixed(10);
    await updateUserData({
      balance: newBalance,
      missions: { ...user.missions, [id]: { claimed: true } }
    });
    popup.style.display = "none";
    document.getElementById("success-msg").innerText = `+${reward} WLC`;
    document.getElementById("popup-success").style.display = "block";
  }

  async function handleInvite(id, reward, completed) {
    if (!completed) {
      const link = `https://t.me/WELLcoin_bot?start=${userId}`;
      document.getElementById("referral-link").value = link;
      document.getElementById("popup-referral").style.display = "block";
      return;
    }
    const user = await getUserData();
    const newBalance = (parseFloat(user.balance || 0) + reward).toFixed(10);
    await updateUserData({
      balance: newBalance,
      missions: { ...user.missions, [id]: { claimed: true } }
    });
    document.getElementById("success-msg").innerText = `+${reward} USDT`;
    document.getElementById("popup-success").style.display = "block";
  }

  async function claimDaily() {
    const user = await getUserData();
    const newBalance = (parseFloat(user.balance || 0) + 1).toFixed(10);
    await updateUserData({
      balance: newBalance,
      missions: { ...user.missions, daily: { lastClaim: Date.now() } }
    });
    document.getElementById("success-msg").innerText = "+1 WLC";
    document.getElementById("popup-success").style.display = "block";
  }

  function copyReferral() {
    const copyText = document.getElementById("referral-link");
    copyText.select();
    copyText.setSelectionRange(0, 99999);
    navigator.clipboard.writeText(copyText.value);
    closePopup("popup-referral");
  }

  
           // خاصة بالبوآب سوشيال ميديا
  function showSocialPopup(callback) {
  document.getElementById("social-popup").style.display = "flex";
  document.getElementById("popup-confirm-btn").onclick = async () => {
    await callback();
    closeSocialPopup();
  };
}

function closeSocialPopup() {
  document.getElementById("social-popup").style.display = "none";
}
telegramClose.onclick = () => {
  telegramPopup.style.display = "none";
};
  
  window.onload = renderMissions;

</script>
